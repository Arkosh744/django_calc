{% extends 'base.html' %}
{% load static %}


{% block header %}
    <title>Калькулятор вальцовки</title>
    <link rel="stylesheet" href="{% static 'css/style_page.css' %}">
    <link rel="stylesheet" href="{% static 'css/style_tube.css' %}">
{% endblock %}

{% block content %}
    <section class="wrapper flex-grow-1">
        <div class="parent" id="content">
            <div class="div1 card shadow-sm">
                <h3>{{ _("Исходные данные") }}</h3>
                <form action="{% url 'forming' %}" method="post" autocomplete="off" id="submit-form">
                    {% csrf_token %}
                    {{ html_forms.material_select.label }}
                    {{ html_forms.material_select }}
                    <div>
                        {{ html_forms.tube_radius.label_tag }}
                        {{ html_forms.tube_radius.name.errors }}
                        {{ html_forms.tube_radius }}
                    </div>
                    <div class="form-thickness">
                        {{ html_forms.tube_thickness.label_tag }}
                        {{ html_forms.tube_thickness.name.errors }}
                        {{ html_forms.tube_thickness }}
                    </div>
                    <button class="btn btn-calc btn-vmeste-color" type="submit" value="calc" name="calc"
                            id="submit">{{ _("Расчет") }}
                    </button>
                </form>

            </div>
        {% if plot %}
            <div class="div-results card shadow-sm">
                <div class="description-spoiler">

                </div>

                {% if tubes_values %}
                    <div class="div2">
                        <h1>{{ _("Результаты расчета") }}</h1>
                        <div class="chart" id="plotty">
                            <script>
                                let graphs = {{ tubes_values }};
                                graphs.config = {
                                    displayModeBar: true,
                                    displaylogo: false,
                                    modeBarButtonsToRemove: ['toImage', 'pan2d', 'zoom2d', 'select2d',
                                        'lasso2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d'],
                                    showLink: true,
                                    plotlyServerURL: "https://chart-studio.plotly.com",
                                    linkText: '{{ _('Edit Online') }}',
                                    modeBarButtonsToAdd: ['drawline']
                                }
                                Plotly.newPlot('plotty', graphs);
                            </script>
                        </div>
                        <div class="text-results">
                            <div class="table-result">
                                <table class="plot-result">
                                    <tr style="border-top:1px solid black; border-bottom:1px solid black">
                                        <td>{{ _('Предел текучести исходного материала') }}</td>
                                        <td>{{ tubes_values }} {{ _('МПа') }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ _('Усреднeнная по сечению величина пластической деформации при гибке листа толщиной') }} {{ form.tube_thickness.data }}
                                            {{ _('мм') }}{{ _(' в заготовку радиусом ') }}{{ form.tube_radius.data }}{{ _('мм') }}</td>
                                        <td>{{ tubes_values }}%</td>
                                    </tr>
                                    <tr>
                                        <td>{{ _('Предел текучести после вальцовки') }}</td>
                                        <td>{{ tubes_values }} {{ _('МПа') }}</td>
                                    </tr>
                                    <tr style="border-bottom:1px solid black">
                                        <td>{{ _('Значение максимальных деформаций после вальцовки') }}:<br> {{ _('Сжимающих') }}
                                            <br> {{ _('Растягивающих') }}</td>
                                        <td><br>{{ tubes_values }} %<br> {{ tubes_values }} %</td>
                                    </tr>
                                    <tr>
                                        <td>{{ _('Усреднeнная по сечению величина пластической деформации после вальцовки и последующей разгибки листа') }}</td>
                                        <td>{{ tubes_values }}%</td>
                                    </tr>
                                    <tr>
                                        <td>{{ _('Предел текучести после вальцовки и последующей разгибки') }}</td>
                                        <td>{{ tubes_values }} {{ _('МПа') }}</td>
                                    </tr>
                                    <tr style="border-bottom:1px solid black">
                                        <td>{{ _('Значение максимальных деформаций после вальцовки и разгибки') }}:<br> {{ _('Сжимающих') }}
                                            <br> {{ _('Растягивающих') }}</td>
                                        <td><br>{{ tubes_values }} %<br> {{ tubes_values }} %</td>
                                    </tr>
                                </table>

                            </div>
                            <div class="results-plot2">
                                <div class="chart chart2" id="plotty2">
                                    <script>
                                        let graphs2 = {{ tubes_values }};
                                        graphs2.config = {
                                            displayModeBar: false,
                                            displaylogo: false,
                                            staticPlot: false,
                                            modeBarButtonsToRemove: ['toImage', 'pan2d', 'zoom2d', 'select2d',
                                                'lasso2d', 'zoomIn2d', 'zoomOut2d', 'autoScale2d', 'toggleSpikelines'],
                                        }
                                        Plotly.newPlot('plotty2', graphs2);
                                    </script>
                                </div>
                                <div class="results-plot-gif">
                                    {#                                    <img src="{{ url_for('static', filename=_('images/forming_animation.gif')) }}"#}
                                    {#                                         alt=""#}
                                    {#                                         id="forming-gif">#}
                                    {#                                    <video autoplay loop muted playsinline controls="controls" width="600px"#}
                                    {#                                           height="400px">#}
                                    {#                                        <source src="#}
                                    {#                                                {{ url_for('static', filename=_('images/forming_animation.mp4')) }}"#}
                                    {#                                                type="video/mp4">#}
                                    {#                                    </video>#}
                                </div>
                                <p style="text-align: center; margin-left: -5%">{{ _("Внутренние волокна") }}</p>
                            </div>

                        </div>
                    </div>
                {% endif %}
            </div>
        {% endif %}
        </div>
    </section>
{% endblock %}

